<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机械振动知识射击挑战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4361EE',
                        secondary: '#3A0CA3',
                        accent: '#F72585',
                        danger: '#4CC9F0',
                        dark: '#10002B',
                        questionBg: '#0F172A',
                    },
                    fontFamily: {
                        game: ['"Rajdhani"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .floating {
                animation: floating 4s infinite ease-in-out;
            }
            .floating-delay-1 {
                animation: floating 3.8s infinite ease-in-out;
            }
            .floating-delay-2 {
                animation: floating 4.2s infinite ease-in-out;
            }
            .floating-delay-3 {
                animation: floating 3.5s infinite ease-in-out;
            }
            .spin-slow {
                animation: spin 15s linear infinite;
            }
            .pulse-slow {
                animation: pulse 3s infinite;
            }
            .shake {
                animation: shake 0.5s;
            }
            .target-enter {
                animation: target-enter 0.8s forwards;
            }
            .bullet {
                position: absolute;
                width: 6px;
                height: 24px;
                background-color: #F72585;
                border-radius: 2px;
                z-index: 10;
            }
            .explosion {
                position: absolute;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                z-index: 20;
                animation: explosion 0.6s forwards;
            }
            .crosshair {
                position: fixed;
                width: 24px;
                height: 24px;
                pointer-events: none;
                z-index: 100;
                transform: translate(-50%, -50%);
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23F72585' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3Cline x1='12' y1='1' x2='12' y2='5'/%3E%3Cline x1='12' y1='19' x2='12' y2='23'/%3E%3Cline x1='4.22' y1='4.22' x2='5.64' y2='5.64'/%3E%3Cline x1='18.36' y1='18.36' x2='19.78' y2='19.78'/%3E%3Cline x1='1' y1='12' x2='5' y2='12'/%3E%3Cline x1='19' y1='12' x2='23' y2='12'/%3E%3Cline x1='4.22' y1='19.78' x2='5.64' y2='18.36'/%3E%3Cline x1='18.36' y1='5.64' x2='19.78' y2='4.22'/%3E%3C/svg%3E");
            }
        }

        @keyframes floating {
            0% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(20px) rotate(-5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            20%, 60% { transform: translateX(-8px) rotate(-2deg); }
            40%, 80% { transform: translateX(8px) rotate(2deg); }
        }
        @keyframes target-enter {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            70% { transform: scale(1.1) rotate(5deg); opacity: 0.9; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes explosion {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-dark via-secondary to-primary min-h-screen font-game text-white overflow-x-hidden">
<!-- 背景装饰 -->
<div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute top-1/4 left-1/5 w-64 h-64 bg-accent/10 rounded-full blur-3xl"></div>
    <div class="absolute top-2/3 right-1/4 w-80 h-80 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-1/4 left-1/3 w-72 h-72 bg-danger/10 rounded-full blur-3xl"></div>
</div>

<!-- 准星 -->
<div class="crosshair hidden" id="crosshair"></div>

<!-- 游戏容器 -->
<div id="game-container" class="relative min-h-screen z-10">
    <!-- 开始界面 -->
    <section id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-4 text-center">
        <div class="max-w-2xl mx-auto">
            <h1 class="text-[clamp(2rem,8vw,4rem)] font-bold text-transparent bg-clip-text bg-gradient-to-r from-danger to-accent mb-6 pulse-slow">
                机械振动知识大冒险
            </h1>
            <p class="text-lg md:text-xl text-slate-200 mb-10">
                准备好测试你的机械振动知识了吗？在每个关卡中，你需要射击与题目描述相符的目标！
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                <div class="bg-dark/50 backdrop-blur-sm rounded-xl p-5 border border-primary/30 hover:border-primary/60 transition-all">
                    <div class="text-danger text-3xl mb-3"><i class="fa fa-crosshairs"></i></div>
                    <h3 class="text-xl font-semibold mb-2">射击正确目标</h3>
                    <p class="text-slate-300">每个关卡会给出一个描述，你需要从四个目标中射击正确的概念</p>
                </div>
                <div class="bg-dark/50 backdrop-blur-sm rounded-xl p-5 border border-primary/30 hover:border-primary/60 transition-all">
                    <div class="text-accent text-3xl mb-3"><i class="fa fa-trophy"></i></div>
                    <h3 class="text-xl font-semibold mb-2">获取最终评价</h3>
                    <p class="text-slate-300">完成全部四个关卡后，将根据你的总表现给出综合评价</p>
                </div>
            </div>

            <!-- 音效开关 -->
            <div class="flex items-center justify-center mb-8">
                <span class="text-slate-300 mr-3">音效：</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="sound-toggle" class="sr-only peer" checked>
                    <div class="w-12 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
                </label>
            </div>

            <button id="start-button" class="bg-gradient-to-r from-danger to-accent hover:opacity-90 text-white font-bold py-4 px-10 rounded-full text-lg transform transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-accent/50">
                开始游戏 <i class="fa fa-play ml-2"></i>
            </button>
        </div>
    </section>

    <!-- 游戏界面 -->
    <section id="game-screen" class="hidden">
        <!-- 顶部状态栏 -->
        <div class="bg-dark/80 backdrop-blur-md p-4 flex justify-between items-center border-b border-primary/30">
            <div>
                <span class="text-slate-300">关卡：</span>
                <span id="level-indicator" class="text-danger font-bold text-xl">1/4</span>
            </div>
            <div>
                <span class="text-slate-300">总得分：</span>
                <span id="score-indicator" class="text-accent font-bold text-xl">0</span>
            </div>
            <div>
                <span class="text-slate-300">剩余时间：</span>
                <span id="time-indicator" class="text-primary font-bold text-xl">30s</span>
            </div>
            <!-- 游戏中音效开关 -->
            <div class="flex items-center">
                <span class="text-slate-300 mr-2">音效：</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="in-game-sound-toggle" class="sr-only peer" checked>
                    <div class="w-10 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-accent"></div>
                </label>
            </div>
        </div>

        <!-- 题目区域 -->
        <div class="p-6 text-center">
            <h2 class="text-[clamp(1.2rem,4vw,1.8rem)] font-semibold mb-3">找出符合以下描述的概念：</h2>
            <div id="question-text" class="bg-questionBg/90 backdrop-blur-sm rounded-xl p-6 max-w-2xl mx-auto text-xl md:text-2xl lg:text-3xl border border-primary/40 shadow-lg">
                物体或物体的一部分在一个位置附近的往复运动
            </div>
        </div>

        <!-- 目标区域 -->
        <div id="targets-container" class="relative w-full min-h-[60vh] px-4 py-8">
            <!-- 目标会通过JS动态生成 -->
        </div>

        <!-- 弹药和控制 -->
        <div class="p-6 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fa fa-circle text-accent mr-2"></i>
                <span id="ammo-indicator" class="text-lg">弹药：5/5</span>
            </div>
            <button id="pause-button" class="bg-dark/60 hover:bg-dark/80 text-white px-4 py-2 rounded-lg transition-all border border-primary/30">
                <i class="fa fa-pause mr-1"></i> 暂停
            </button>
        </div>
    </section>

    <!-- 关卡过渡界面 -->
    <section id="level-transition" class="hidden flex flex-col items-center justify-center min-h-screen p-4 text-center">
        <div class="bg-dark/80 backdrop-blur-md rounded-2xl p-8 max-w-md w-full border border-primary/30">
            <div class="text-5xl mb-6 text-danger">
                <i class="fa fa-arrow-right"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">关卡 <span id="transition-level">1</span> 完成！</h2>
            <p class="text-xl text-slate-300 mb-8">准备好挑战下一关了吗？</p>

            <button id="next-level-button" class="w-full bg-gradient-to-r from-danger to-accent hover:opacity-90 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105">
                进入关卡 <span id="next-level-number">2</span> <i class="fa fa-arrow-right ml-1"></i>
            </button>
        </div>
    </section>

    <!-- 游戏结束界面 -->
    <section id="game-over" class="hidden flex flex-col items-center justify-center min-h-screen p-4 text-center">
        <div class="bg-dark/80 backdrop-blur-md rounded-2xl p-8 max-w-md w-full border border-primary/30">
            <div class="text-6xl mb-6 text-gradient bg-clip-text text-transparent bg-gradient-to-r from-danger to-accent pulse-slow">
                <i class="fa fa-trophy"></i>
            </div>
            <h2 class="text-3xl font-bold mb-6">挑战完成！</h2>

            <div class="mb-8 space-y-6">
                <div>
                    <p class="text-slate-300">总得分</p>
                    <p id="final-score" class="text-4xl font-bold text-accent">0</p>
                </div>
                <div>
                    <p class="text-slate-300">最终评价</p>
                    <p id="final-rating" class="text-2xl font-bold text-danger">完美大师</p>
                </div>
                <div class="w-full bg-dark rounded-full h-3">
                    <div id="final-progress" class="bg-gradient-to-r from-danger to-accent h-3 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <button id="restart-button" class="w-full bg-gradient-to-r from-danger to-accent hover:opacity-90 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105">
                再玩一次 <i class="fa fa-refresh ml-1"></i>
            </button>
        </div>
    </section>

    <!-- 暂停菜单 -->
    <section id="pause-menu" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="bg-dark/90 rounded-2xl p-6 max-w-sm w-full text-center border border-primary/30">
            <h2 class="text-2xl font-bold mb-6">游戏暂停</h2>
            <div class="space-y-3">
                <button id="resume-button" class="w-full bg-gradient-to-r from-danger to-accent hover:opacity-90 text-white font-bold py-3 px-6 rounded-lg transition-all">
                    继续游戏 <i class="fa fa-play ml-1"></i>
                </button>
                <button id="restart-level-button" class="w-full bg-dark/60 hover:bg-dark/80 text-white font-bold py-3 px-6 rounded-lg transition-all border border-primary/30">
                    重玩本关 <i class="fa fa-refresh ml-1"></i>
                </button>
                <button id="quit-button" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 px-6 rounded-lg transition-all">
                    退出游戏 <i class="fa fa-sign-out ml-1"></i>
                </button>
            </div>
        </div>
    </section>
</div>

<!-- 音效元素 -->
<audio id="shoot-sound" preload="auto">
    <source src="shoot_sound.mp3" type="audio/mpeg">
</audio>
<audio id="correct-sound" preload="auto">
    <source src="hit_sound.mp3" type="audio/mpeg">
</audio>
<audio id="wrong-sound" preload="auto">
    <source src="miss_sound.mp3" type="audio/mpeg">
</audio>
<audio id="level-complete-sound" preload="auto">
    <source src="congratulation.mp3" type="audio/mpeg">
</audio>

<script>
    // 游戏状态
    const gameState = {
        currentLevel: 1,
        score: 0,
        timeRemaining: 30,
        ammo: 5,
        currentTargets: [],
        correctTarget: '',
        timer: null,
        isPaused: false,
        levelScores: [], // 存储每关得分
        soundEnabled: true // 音效开关状态
    };

    // 游戏数据 - 四个关卡的题目和答案
    const gameData = [
        {
            question: "物体或物体的一部分在一个位置附近的往复运动",
            correct: "机械振动",
            options: ["机械振动", "简谐运动", "机械波", "受迫振动"]
        },
        {
            question: "位移与时间的关系遵从正弦函数的规律，振动图像是一条正弦曲线",
            correct: "简谐运动",
            options: ["机械振动", "简谐运动", "机械波", "受迫振动"]
        },
        {
            question: "机械振动在介质中的传播（一个质点带动其它质点的振动）",
            correct: "机械波",
            options: ["机械振动", "简谐运动", "机械波", "受迫振动"]
        },
        {
            question: "周期和频率由驱动力决定，与振动物体的固有周期和频率无关",
            correct: "受迫振动",
            options: ["机械振动", "简谐运动", "机械波", "受迫振动"]
        }
    ];

    // DOM元素
    const elements = {
        startScreen: document.getElementById('start-screen'),
        gameScreen: document.getElementById('game-screen'),
        levelTransition: document.getElementById('level-transition'),
        gameOver: document.getElementById('game-over'),
        pauseMenu: document.getElementById('pause-menu'),
        startButton: document.getElementById('start-button'),
        nextLevelButton: document.getElementById('next-level-button'),
        restartButton: document.getElementById('restart-button'),
        pauseButton: document.getElementById('pause-button'),
        resumeButton: document.getElementById('resume-button'),
        restartLevelButton: document.getElementById('restart-level-button'),
        quitButton: document.getElementById('quit-button'),
        levelIndicator: document.getElementById('level-indicator'),
        scoreIndicator: document.getElementById('score-indicator'),
        timeIndicator: document.getElementById('time-indicator'),
        questionText: document.getElementById('question-text'),
        ammoIndicator: document.getElementById('ammo-indicator'),
        targetsContainer: document.getElementById('targets-container'),
        transitionLevel: document.getElementById('transition-level'),
        nextLevelNumber: document.getElementById('next-level-number'),
        finalScore: document.getElementById('final-score'),
        finalRating: document.getElementById('final-rating'),
        finalProgress: document.getElementById('final-progress'),
        crosshair: document.getElementById('crosshair'),
        soundToggle: document.getElementById('sound-toggle'),
        inGameSoundToggle: document.getElementById('in-game-sound-toggle'),

        // 音效元素
        sounds: {
            shoot: document.getElementById('shoot-sound'),
            correct: document.getElementById('correct-sound'),
            wrong: document.getElementById('wrong-sound'),
            levelComplete: document.getElementById('level-complete-sound')
        }
    };

    // 播放音效
    function playSound(soundId) {
        if (!gameState.soundEnabled) return;

        const sound = elements.sounds[soundId];
        if (sound) {
            // 重置并播放音效
            sound.currentTime = 0;
            sound.play().catch(e => {
                console.log("音效播放失败:", e);
            });
        }
    }

    // 初始化游戏
    function initGame() {
        // 事件监听
        elements.startButton.addEventListener('click', startGame);
        elements.nextLevelButton.addEventListener('click', goToNextLevel);
        elements.restartButton.addEventListener('click', restartGame);
        elements.pauseButton.addEventListener('click', pauseGame);
        elements.resumeButton.addEventListener('click', resumeGame);
        elements.restartLevelButton.addEventListener('click', restartCurrentLevel);
        elements.quitButton.addEventListener('click', quitGame);

        // 音效开关事件
        elements.soundToggle.addEventListener('change', (e) => {
            gameState.soundEnabled = e.target.checked;
            elements.inGameSoundToggle.checked = e.target.checked;
        });

        elements.inGameSoundToggle.addEventListener('change', (e) => {
            gameState.soundEnabled = e.target.checked;
            elements.soundToggle.checked = e.target.checked;
        });

        // 鼠标移动显示准星
        document.addEventListener('mousemove', (e) => {
            if (!elements.gameScreen.classList.contains('hidden') && !gameState.isPaused) {
                elements.crosshair.style.left = `${e.clientX}px`;
                elements.crosshair.style.top = `${e.clientY}px`;
            }
        });

        // 点击射击
        elements.targetsContainer.addEventListener('click', handleShoot);
    }

    // 开始游戏
    function startGame() {
        elements.startScreen.classList.add('hidden');
        elements.gameScreen.classList.remove('hidden');
        elements.crosshair.classList.remove('hidden');

        gameState.currentLevel = 1;
        gameState.score = 0;
        gameState.levelScores = [];
        gameState.soundEnabled = elements.soundToggle.checked;

        startLevel(gameState.currentLevel);
    }

    // 开始关卡
    function startLevel(level) {
        // 重置关卡状态
        gameState.timeRemaining = 30;
        gameState.ammo = 5;
        gameState.currentTargets = [];

        // 更新UI
        elements.levelIndicator.textContent = `${level}/${gameData.length}`;
        elements.scoreIndicator.textContent = gameState.score;
        elements.timeIndicator.textContent = `${gameState.timeRemaining}s`;
        elements.ammoIndicator.textContent = `弹药：${gameState.ammo}/5`;

        // 重置时间指示器样式
        elements.timeIndicator.classList.remove('text-accent', 'pulse');

        // 设置题目
        const levelData = gameData[level - 1];
        elements.questionText.textContent = levelData.question;
        gameState.correctTarget = levelData.correct;

        // 生成目标
        generateTargets(levelData.options);

        // 开始计时
        if (gameState.timer) clearInterval(gameState.timer);
        gameState.timer = setInterval(updateTimer, 1000);
    }

    // 生成目标
    function generateTargets(options) {
        elements.targetsContainer.innerHTML = '';

        // 随机排序选项
        const shuffledOptions = [...options].sort(() => Math.random() - 0.5);

        // 目标位置分布
        const positions = [
            { top: '5%', left: '15%' },
            { top: '25%', left: '75%' },
            { top: '60%', left: '20%' },
            { top: '70%', left: '70%' }
        ];

        // 不同目标的动画类
        const animationClasses = ['floating', 'floating-delay-1', 'floating-delay-2', 'floating-delay-3'];

        // 创建目标元素
        shuffledOptions.forEach((option, index) => {
            const target = document.createElement('div');
            const position = positions[index];
            const animation = animationClasses[index];

            // 为不同概念设置不同颜色
            let targetColor = 'bg-slate-600';
            if (option === '机械振动') targetColor = 'bg-primary';
            if (option === '简谐运动') targetColor = 'bg-secondary';
            if (option === '机械波') targetColor = 'bg-accent';
            if (option === '受迫振动') targetColor = 'bg-danger';

            target.className = `target absolute target-enter cursor-pointer transition-all ${targetColor} ${animation}`;
            target.style.top = position.top;
            target.style.left = position.left;
            target.dataset.concept = option;

            // 目标HTML结构
            target.innerHTML = `
                    <div class="relative w-36 h-36 md:w-44 md:h-44 lg:w-52 lg:h-52 flex items-center justify-center">
                        <div class="absolute w-full h-full rounded-full bg-white/10"></div>
                        <div class="absolute w-4/5 h-4/5 rounded-full bg-white/15"></div>
                        <div class="absolute w-3/5 h-3/5 rounded-full bg-white/20"></div>
                        <div class="absolute w-2/5 h-2/5 rounded-full bg-white/25"></div>
                        <div class="absolute w-1/5 h-1/5 rounded-full bg-white/30"></div>
                        <span class="text-white font-bold text-center z-10 px-2 text-base md:text-lg">${option}</span>
                    </div>
                `;

            elements.targetsContainer.appendChild(target);
            gameState.currentTargets.push(target);
        });
    }

    // 处理射击
    function handleShoot(e) {
        if (gameState.ammo <= 0 || gameState.isPaused) return;

        const target = e.target.closest('.target');
        if (!target) return;

        // 播放射击音效
        playSound('shoot');

        // 减少弹药
        gameState.ammo--;
        elements.ammoIndicator.textContent = `弹药：${gameState.ammo}/5`;

        // 创建子弹效果
        createBulletEffect(e.clientX, e.clientY);

        // 创建爆炸效果
        createExplosionEffect(target);

        // 判断是否射中正确目标
        const isCorrect = target.dataset.concept === gameState.correctTarget;

        if (isCorrect) {
            // 播放正确音效
            playSound('correct');

            // 正确 - 计算得分
            const levelScore = calculateScore();
            gameState.score += levelScore;
            gameState.levelScores.push(levelScore);
            elements.scoreIndicator.textContent = gameState.score;

            // 显示关卡过渡界面
            endLevel();
        } else {
            // 播放错误音效
            playSound('wrong');

            // 错误 - 震动效果
            target.classList.add('shake');
            setTimeout(() => target.classList.remove('shake'), 500);

            // 如果弹药耗尽，结束关卡（得0分）
            if (gameState.ammo <= 0) {
                gameState.levelScores.push(0);
                endLevel();
            }
        }
    }

    // 创建子弹效果
    function createBulletEffect(x, y) {
        const bullet = document.createElement('div');
        bullet.className = 'bullet';

        // 从底部中央发射
        const centerX = window.innerWidth / 2;
        const bottomY = window.innerHeight - 100;

        bullet.style.left = `${centerX}px`;
        bullet.style.top = `${bottomY}px`;
        document.body.appendChild(bullet);

        // 计算子弹轨迹
        const dx = x - centerX;
        const dy = y - bottomY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const duration = distance / 4; // 速度

        // 动画
        bullet.animate([
            { transform: 'translate(0, 0) rotate(0deg)' },
            { transform: `translate(${dx}px, ${dy}px) rotate(${dx * 0.1}deg)` }
        ], {
            duration: duration,
            easing: 'linear'
        });

        // 移除子弹元素
        setTimeout(() => bullet.remove(), duration);
    }

    // 创建爆炸效果
    function createExplosionEffect(target) {
        const explosion = document.createElement('div');
        explosion.className = 'explosion';

        // 爆炸颜色与目标匹配
        if (target.classList.contains('bg-primary')) explosion.style.backgroundColor = 'rgba(67, 97, 238, 0.7)';
        if (target.classList.contains('bg-secondary')) explosion.style.backgroundColor = 'rgba(58, 12, 163, 0.7)';
        if (target.classList.contains('bg-accent')) explosion.style.backgroundColor = 'rgba(247, 37, 133, 0.7)';
        if (target.classList.contains('bg-danger')) explosion.style.backgroundColor = 'rgba(76, 201, 240, 0.7)';

        // 定位到目标中心
        const rect = target.getBoundingClientRect();
        explosion.style.left = `${rect.left + rect.width/2 - 40}px`;
        explosion.style.top = `${rect.top + rect.height/2 - 40}px`;

        document.body.appendChild(explosion);

        // 移除目标和爆炸效果
        target.style.opacity = '0';
        setTimeout(() => {
            target.remove();
            explosion.remove();
        }, 600);
    }

    // 计算得分
    function calculateScore() {
        // 基于剩余时间和弹药计算分数（每关最高100分）
        const timeBonus = (gameState.timeRemaining / 30) * 50;
        const ammoBonus = (gameState.ammo / 5) * 50;
        return Math.round(timeBonus + ammoBonus);
    }

    // 更新计时器
    function updateTimer() {
        if (gameState.isPaused) return;

        gameState.timeRemaining--;
        elements.timeIndicator.textContent = `${gameState.timeRemaining}s`;

        // 时间警告（最后10秒）
        if (gameState.timeRemaining <= 10) {
            elements.timeIndicator.classList.add('text-accent', 'pulse');
        }

        // 时间到
        if (gameState.timeRemaining <= 0) {
            clearInterval(gameState.timer);
            gameState.levelScores.push(0);
            endLevel();
        }
    }

    // 结束关卡（显示过渡界面）
    function endLevel() {
        clearInterval(gameState.timer);

        // 播放关卡完成音效
        playSound('levelComplete');

        // 更新过渡界面
        elements.transitionLevel.textContent = gameState.currentLevel;
        elements.nextLevelNumber.textContent = gameState.currentLevel + 1;

        // 显示过渡界面
        elements.gameScreen.classList.add('hidden');
        elements.levelTransition.classList.remove('hidden');
    }

    // 进入下一关
    function goToNextLevel() {
        gameState.currentLevel++;

        elements.levelTransition.classList.add('hidden');

        if (gameState.currentLevel > gameData.length) {
            // 游戏结束，显示最终评价
            showFinalResult();
        } else {
            // 下一关
            elements.gameScreen.classList.remove('hidden');
            startLevel(gameState.currentLevel);
        }
    }

    // 显示最终结果和评价
    function showFinalResult() {
        // 计算总分和平均分
        const totalScore = gameState.score;
        const averageScore = totalScore / gameData.length;

        // 计算最终评价
        let finalRating;
        if (averageScore >= 90) finalRating = "完美大师";
        else if (averageScore >= 70) finalRating = "振动专家";
        else if (averageScore >= 50) finalRating = "波动学者";
        else if (averageScore >= 30) finalRating = "探索者";
        else finalRating = "初学者";

        // 更新最终界面
        elements.finalScore.textContent = totalScore;
        elements.finalRating.textContent = finalRating;
        elements.finalProgress.style.width = `${(totalScore / (gameData.length * 100)) * 100}%`;

        // 显示最终界面
        elements.gameOver.classList.remove('hidden');
    }

    // 暂停游戏
    function pauseGame() {
        gameState.isPaused = true;
        elements.pauseMenu.classList.remove('hidden');
    }

    // 恢复游戏
    function resumeGame() {
        gameState.isPaused = false;
        elements.pauseMenu.classList.add('hidden');
    }

    // 重玩当前关卡
    function restartCurrentLevel() {
        // 移除当前关卡的分数
        if (gameState.levelScores.length >= gameState.currentLevel) {
            const lastScore = gameState.levelScores.pop();
            gameState.score -= lastScore;
        }

        gameState.isPaused = false;
        elements.pauseMenu.classList.add('hidden');
        elements.gameScreen.classList.remove('hidden');
        startLevel(gameState.currentLevel);
    }

    // 退出游戏
    function quitGame() {
        clearInterval(gameState.timer);
        gameState.isPaused = false;
        elements.pauseMenu.classList.add('hidden');
        elements.gameScreen.classList.add('hidden');
        elements.startScreen.classList.remove('hidden');
        elements.crosshair.classList.add('hidden');
    }

    // 重新开始游戏
    function restartGame() {
        elements.gameOver.classList.add('hidden');
        elements.startScreen.classList.remove('hidden');
    }

    // 初始化游戏
    window.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>